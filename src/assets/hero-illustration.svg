<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 500" fill="none">
  <defs>
    <!-- Gradients -->
    <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#10b981"/>
      <stop offset="100%" stop-color="#6ee7b7"/>
    </linearGradient>

    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#8b5cf6"/>
      <stop offset="100%" stop-color="#c4b5fd"/>
    </linearGradient>

    <!-- Glow effect -->
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Card shadow -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background grid -->
  <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
    <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#1a1a1a" stroke-width="0.5"/>
  </pattern>
  <rect width="1200" height="500" fill="url(#grid)" opacity="0.6"/>

  <!-- ============ STAGE 1: AGENT ============ -->
  <g class="stage stage-1">
    <g filter="url(#shadow)">
      <rect x="60" y="120" width="140" height="130" rx="12" fill="#171717" stroke="#8b5cf6" stroke-width="2"/>
      <circle cx="130" cy="160" r="26" fill="#1e1e1e" stroke="#8b5cf6" stroke-width="2"/>
      <text x="130" y="167" fill="#c4b5fd" font-size="20" text-anchor="middle" font-family="system-ui" font-weight="600">AI</text>
      <text x="130" y="205" fill="#e5e7eb" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Claude / MCP</text>
      <text x="130" y="225" fill="#6b7280" font-size="9" text-anchor="middle" font-family="monospace">Creates specs</text>
      <text x="130" y="238" fill="#6b7280" font-size="9" text-anchor="middle" font-family="monospace">Queries status</text>
    </g>
    <text x="130" y="98" fill="#8b5cf6" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Agent</text>
  </g>

  <!-- ============ STAGE 2: CONNECTIONS TO REQUIREMENTS ============ -->
  <g class="stage stage-2">
    <path class="flow-line line-1" d="M 200 160 C 270 140, 310 135, 370 130" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-2" d="M 200 185 C 270 185, 310 185, 370 185" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-3" d="M 200 210 C 270 230, 310 240, 370 240" stroke="url(#purpleGrad)" stroke-width="2.5" fill="none"/>
  </g>

  <!-- ============ STAGE 3: REQUIREMENTS ============ -->
  <g class="stage stage-3">
    <g filter="url(#shadow)">
      <rect x="370" y="100" width="130" height="50" rx="6" fill="#171717" stroke="#262626"/>
      <text x="435" y="121" fill="#9ca3af" font-size="10" text-anchor="middle" font-family="monospace">REQ-AUTH-001</text>
      <text x="435" y="138" fill="#10b981" font-size="9" text-anchor="middle" font-family="system-ui">OAuth Login</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="370" y="160" width="130" height="50" rx="6" fill="#171717" stroke="#262626"/>
      <text x="435" y="181" fill="#9ca3af" font-size="10" text-anchor="middle" font-family="monospace">REQ-API-001</text>
      <text x="435" y="198" fill="#10b981" font-size="9" text-anchor="middle" font-family="system-ui">REST API</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="370" y="220" width="130" height="50" rx="6" fill="#171717" stroke="#262626"/>
      <text x="435" y="241" fill="#9ca3af" font-size="10" text-anchor="middle" font-family="monospace">REQ-DATA-001</text>
      <text x="435" y="258" fill="#10b981" font-size="9" text-anchor="middle" font-family="system-ui">Database</text>
    </g>
    <text x="435" y="80" fill="#6b7280" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Requirements</text>
  </g>

  <!-- ============ STAGE 4: CONNECTIONS TO TESTS ============ -->
  <g class="stage stage-4">
    <path class="flow-line line-4" d="M 500 125 Q 540 130, 580 155" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-5" d="M 500 185 Q 540 185, 580 185" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-6" d="M 500 245 Q 540 240, 580 215" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  </g>

  <!-- ============ STAGE 5: TESTS ============ -->
  <g class="stage stage-5">
    <g filter="url(#shadow)">
      <rect x="580" y="115" width="150" height="145" rx="10" fill="#171717" stroke="#10b981" stroke-width="2"/>
      <text x="655" y="143" fill="#e5e7eb" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="600">pytest</text>
      <text x="655" y="162" fill="#6b7280" font-size="9" text-anchor="middle" font-family="monospace">@pytest.mark.req</text>
      <rect x="598" y="175" width="114" height="22" rx="4" fill="#1e1e1e"/>
      <text x="655" y="190" fill="#22c55e" font-size="11" text-anchor="middle" font-family="monospace">✓ 54 passed</text>
      <rect x="598" y="201" width="114" height="22" rx="4" fill="#1e1e1e"/>
      <text x="655" y="216" fill="#f59e0b" font-size="11" text-anchor="middle" font-family="monospace">△ 0 partial</text>
      <rect x="598" y="227" width="114" height="22" rx="4" fill="#1e1e1e"/>
      <text x="655" y="242" fill="#ef4444" font-size="11" text-anchor="middle" font-family="monospace">✗ 19 missing</text>
    </g>
    <text x="655" y="98" fill="#10b981" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Tests</text>
  </g>

  <!-- ============ STAGE 6: CONNECTIONS TO STATUS ============ -->
  <g class="stage stage-6">
    <path class="flow-line line-7" d="M 730 155 Q 770 140, 810 135" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-8" d="M 730 185 Q 770 185, 810 185" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
    <path class="flow-line line-9" d="M 730 215 Q 770 230, 810 235" stroke="url(#lineGrad)" stroke-width="2.5" fill="none"/>
  </g>

  <!-- ============ STAGE 7: STATUS ============ -->
  <g class="stage stage-7">
    <g filter="url(#shadow)">
      <rect x="810" y="90" width="170" height="200" rx="10" fill="#171717" stroke="#262626"/>
      <rect x="810" y="90" width="170" height="26" rx="10" fill="#2d2d2d"/>
      <circle cx="826" cy="103" r="4" fill="#ff5f56"/>
      <circle cx="840" cy="103" r="4" fill="#ffbd2e"/>
      <circle cx="854" cy="103" r="4" fill="#27ca40"/>
      <text x="920" y="107" fill="#6b7280" font-size="8" text-anchor="middle" font-family="system-ui">rtmx status</text>
      <text x="830" y="138" fill="#9ca3af" font-size="9" font-family="monospace">Requirements:</text>
      <rect x="830" y="145" width="130" height="12" rx="2" fill="#262626"/>
      <rect class="progress-bar" x="830" y="145" width="96" height="12" rx="2" fill="#22c55e"/>
      <text x="968" y="155" fill="#9ca3af" font-size="9" font-family="monospace">74%</text>
      <text x="840" y="182" fill="#22c55e" font-size="10" font-family="monospace">✓ 54 complete</text>
      <text x="840" y="200" fill="#f59e0b" font-size="10" font-family="monospace">△ 0 partial</text>
      <text x="840" y="218" fill="#ef4444" font-size="10" font-family="monospace">✗ 19 missing</text>
      <text x="840" y="240" fill="#6b7280" font-size="9" font-family="monospace">(73 total)</text>
      <text x="840" y="262" fill="#9ca3af" font-size="8" font-family="monospace">P1-P6: 100% ✓</text>
      <text x="840" y="278" fill="#f59e0b" font-size="8" font-family="monospace">P7-P8: In Progress</text>
    </g>
    <text x="895" y="72" fill="#6b7280" font-size="12" text-anchor="middle" font-family="system-ui" font-weight="600">Status</text>
  </g>

  <!-- ============ STAGE 8: CLOSED LOOP (feedback arrow) ============ -->
  <g class="stage stage-8">
    <path class="loop-path" d="M 940 185 C 1020 185, 1080 60, 600 20 C 200 -20, 80 80, 100 185"
          stroke="#8b5cf6" stroke-width="2" fill="none" opacity="0.6"/>
    <polygon class="loop-arrow" points="100,175 90,185 100,195 95,185" fill="#8b5cf6"/>
  </g>

  <!-- ============ FOOTER: WORKFLOW LEGEND ============ -->
  <rect x="0" y="370" width="1200" height="130" fill="#0d0d0d"/>
  <line x1="0" y1="370" x2="1200" y2="370" stroke="#262626" stroke-width="1"/>

  <!-- Main tagline -->
  <text x="600" y="410" fill="#f9fafb" font-size="20" text-anchor="middle" font-family="system-ui" font-weight="700">
    Distributed Closed-Loop Verification
  </text>

  <!-- Workflow steps -->
  <g class="step step-1">
    <g transform="translate(100, 435)">
      <circle cx="0" cy="12" r="14" fill="#8b5cf6" opacity="0.2"/>
      <text x="0" y="17" fill="#8b5cf6" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="700">1</text>
      <text x="38" y="8" fill="#c4b5fd" font-size="10" font-family="system-ui" font-weight="600">WRITE</text>
      <text x="38" y="22" fill="#6b7280" font-size="9" font-family="system-ui">Agent creates specs</text>
    </g>
  </g>

  <g class="step step-2">
    <g transform="translate(310, 435)">
      <circle cx="0" cy="12" r="14" fill="#10b981" opacity="0.2"/>
      <text x="0" y="17" fill="#10b981" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="700">2</text>
      <text x="38" y="8" fill="#6ee7b7" font-size="10" font-family="system-ui" font-weight="600">LINK</text>
      <text x="38" y="22" fill="#6b7280" font-size="9" font-family="system-ui">Tests trace to reqs</text>
    </g>
  </g>

  <g class="step step-3">
    <g transform="translate(510, 435)">
      <circle cx="0" cy="12" r="14" fill="#10b981" opacity="0.2"/>
      <text x="0" y="17" fill="#10b981" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="700">3</text>
      <text x="38" y="8" fill="#6ee7b7" font-size="10" font-family="system-ui" font-weight="600">REPORT</text>
      <text x="38" y="22" fill="#6b7280" font-size="9" font-family="system-ui">Real-time status</text>
    </g>
  </g>

  <g class="step step-4">
    <g transform="translate(720, 435)">
      <circle cx="0" cy="12" r="14" fill="#8b5cf6" opacity="0.2"/>
      <text x="0" y="17" fill="#8b5cf6" font-size="13" text-anchor="middle" font-family="system-ui" font-weight="700">4</text>
      <text x="38" y="8" fill="#c4b5fd" font-size="10" font-family="system-ui" font-weight="600">VERIFY</text>
      <text x="38" y="22" fill="#6b7280" font-size="9" font-family="system-ui">Agent queries MCP</text>
    </g>
  </g>

  <g class="step step-loop">
    <g transform="translate(930, 435)">
      <path d="M 0 12 C 25 -8, 50 -8, 50 12 C 50 32, 25 32, 0 12" stroke="#8b5cf6" stroke-width="2" fill="none"/>
      <polygon points="5,8 0,12 5,16" fill="#8b5cf6"/>
      <text x="75" y="8" fill="#c4b5fd" font-size="10" font-family="system-ui" font-weight="600">LOOP</text>
      <text x="75" y="22" fill="#6b7280" font-size="9" font-family="system-ui">Continuous cycle</text>
    </g>
  </g>

  <!-- Animation CSS - LOOPING -->
  <style>
    /* Total cycle: 10s, then restart */
    .stage {
      opacity: 0;
    }

    .stage-1 { animation: fadeInOut 10s ease-out infinite; animation-delay: 0s; }
    .stage-2 { animation: fadeInOut 10s ease-out infinite; animation-delay: 0.8s; }
    .stage-3 { animation: fadeInOut 10s ease-out infinite; animation-delay: 1.4s; }
    .stage-4 { animation: fadeInOut 10s ease-out infinite; animation-delay: 2.2s; }
    .stage-5 { animation: fadeInOut 10s ease-out infinite; animation-delay: 2.8s; }
    .stage-6 { animation: fadeInOut 10s ease-out infinite; animation-delay: 3.6s; }
    .stage-7 { animation: fadeInOut 10s ease-out infinite; animation-delay: 4.2s; }
    .stage-8 { animation: fadeInOut 10s ease-out infinite; animation-delay: 5.5s; }

    /* Flow lines animate stroke */
    .flow-line {
      stroke-dasharray: 200;
      stroke-dashoffset: 200;
    }

    .line-1 { animation: drawLine 10s ease-out infinite; animation-delay: 0.8s; }
    .line-2 { animation: drawLine 10s ease-out infinite; animation-delay: 0.9s; }
    .line-3 { animation: drawLine 10s ease-out infinite; animation-delay: 1.0s; }
    .line-4 { animation: drawLine 10s ease-out infinite; animation-delay: 2.2s; }
    .line-5 { animation: drawLine 10s ease-out infinite; animation-delay: 2.3s; }
    .line-6 { animation: drawLine 10s ease-out infinite; animation-delay: 2.4s; }
    .line-7 { animation: drawLine 10s ease-out infinite; animation-delay: 3.6s; }
    .line-8 { animation: drawLine 10s ease-out infinite; animation-delay: 3.7s; }
    .line-9 { animation: drawLine 10s ease-out infinite; animation-delay: 3.8s; }

    /* Loop path animation */
    .loop-path {
      stroke-dasharray: 1200;
      stroke-dashoffset: 1200;
      animation: drawLoop 10s ease-out infinite;
      animation-delay: 5.5s;
    }

    .loop-arrow {
      opacity: 0;
      animation: fadeInOut 10s ease-out infinite;
      animation-delay: 7s;
    }

    /* Progress bar animation */
    .progress-bar {
      animation: growBar 10s ease-out infinite;
      animation-delay: 4.5s;
    }

    /* Step highlights */
    .step { opacity: 0.3; }
    .step-1 { animation: highlightStep 10s ease-out infinite; animation-delay: 0s; }
    .step-2 { animation: highlightStep 10s ease-out infinite; animation-delay: 2s; }
    .step-3 { animation: highlightStep 10s ease-out infinite; animation-delay: 3.5s; }
    .step-4 { animation: highlightStep 10s ease-out infinite; animation-delay: 5s; }
    .step-loop { animation: highlightStep 10s ease-out infinite; animation-delay: 7s; }

    @keyframes fadeInOut {
      0% { opacity: 0; }
      8% { opacity: 1; }
      85% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes drawLine {
      0% { stroke-dashoffset: 200; }
      5% { stroke-dashoffset: 0; }
      85% { stroke-dashoffset: 0; }
      100% { stroke-dashoffset: 200; }
    }

    @keyframes drawLoop {
      0% { stroke-dashoffset: 1200; }
      15% { stroke-dashoffset: 0; }
      85% { stroke-dashoffset: 0; }
      100% { stroke-dashoffset: 1200; }
    }

    @keyframes growBar {
      0% { width: 0; }
      10% { width: 96px; }
      85% { width: 96px; }
      100% { width: 0; }
    }

    @keyframes highlightStep {
      0% { opacity: 0.3; }
      5% { opacity: 1; }
      25% { opacity: 1; }
      30% { opacity: 0.3; }
      100% { opacity: 0.3; }
    }
  </style>
</svg>
